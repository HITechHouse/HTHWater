import{b4 as X,P as B,g2 as m,aV as y,g1 as v,ca as R,bu as U,_ as Y,v as b,bv as x,c9 as T,C as k}from"./index-ee1133ea.js";import{ac as d,ay as g,o as h,ar as V,at as G,as as H,S as _,z as J,a3 as q,a9 as L,az as M,aA as Z,aB as $,aC as z,u as P,aD as nn,ae as D,aE as tn,aF as en,aG as rn,ap as W,r as j,af as C}from"./arcade-31f55eeb.js";import{a as o,r as s}from"./unitConversion-f06e764a.js";import{o as O}from"./TimeOnly-84d56e10.js";import{l as K}from"./portalUtils-2e95c4ea.js";import{a as f}from"./operatorsWorkerConnection-a6448476.js";import"./ImmutableArray-d5cad66d.js";import"./shared-38e6dd3a.js";import"./number-7fd81199.js";import"./featureConversionUtils-f7d818ce.js";import"./OptimizedFeature-85f1966b.js";import"./memoryEstimations-c448ab60.js";import"./OptimizedGeometry-3060442a.js";import"./OptimizedFeatureSet-1d1ac4b9.js";import"./WhereClause-5746b47b.js";async function Q(a,t,e){var r,i;if(!((r=X)==null?void 0:r.findCredential(a.restUrl)))return null;if(a.loadStatus==="loaded"&&t===""&&((i=a.user)!=null&&i.sourceJSON)&&e===!1)return a.user.sourceJSON;const u={responseType:"json",query:{f:"json"}};if(e&&(u.query.returnUserLicenseTypeExtensions=!0),t===""){const c=await B(a.restUrl+"/community/self",u);if(c.data){const w=c.data;if(w!=null&&w.username)return w}return null}const n=await B(a.restUrl+"/community/users/"+t,u);if(n.data){const c=n.data;return c.error?null:c}return null}function p(a){if(a==null)return a;switch(typeof a){case"string":case"number":return a;default:throw new o(null,s.InvalidParameter,null)}}function gn(a){a.mode==="async"&&(a.functions.disjoint=function(t,e){return a.standardFunctionAsync(t,e,(l,u,n)=>(n=d(n),g(n,t,e),n[0]===null||n[1]===null||f("disjoint",[n[0].toJSON(),n[1].toJSON()])))},a.functions.intersects=function(t,e){return a.standardFunctionAsync(t,e,(l,u,n)=>(n=d(n),g(n,t,e),n[0]!==null&&n[1]!==null&&f("intersects",[n[0].toJSON(),n[1].toJSON()])))},a.functions.touches=function(t,e){return a.standardFunctionAsync(t,e,(l,u,n)=>(n=d(n),g(n,t,e),n[0]!==null&&n[1]!==null&&f("touches",[n[0].toJSON(),n[1].toJSON()])))},a.functions.crosses=function(t,e){return a.standardFunctionAsync(t,e,(l,u,n)=>(n=d(n),g(n,t,e),n[0]!==null&&n[1]!==null&&f("crosses",[n[0].toJSON(),n[1].toJSON()])))},a.functions.within=function(t,e){return a.standardFunctionAsync(t,e,(l,u,n)=>(n=d(n),g(n,t,e),n[0]!==null&&n[1]!==null&&f("within",[n[0].toJSON(),n[1].toJSON()])))},a.functions.contains=function(t,e){return a.standardFunctionAsync(t,e,(l,u,n)=>(n=d(n),g(n,t,e),n[0]!==null&&n[1]!==null&&f("contains",[n[0].toJSON(),n[1].toJSON()])))},a.functions.overlaps=function(t,e){return a.standardFunctionAsync(t,e,(l,u,n)=>(n=d(n),g(n,t,e),n[0]!==null&&n[1]!==null&&f("overlaps",[n[0].toJSON(),n[1].toJSON()])))},a.functions.equals=function(t,e){return a.standardFunctionAsync(t,e,(l,u,n)=>(h(n,2,2,t,e),n[0]===n[1]||(n[0]instanceof m&&n[1]instanceof m?f("equals",[n[0].toJSON(),n[1].toJSON()]):(V(n[0])&&V(n[1])||!!(G(n[0])&&G(n[1])||H(n[0])&&H(n[1])))&&n[0].equals(n[1]))))},a.functions.relate=function(t,e){return a.standardFunctionAsync(t,e,(l,u,n)=>{if(n=d(n),h(n,3,3,t,e),n[0]instanceof m&&n[1]instanceof m)return f("relate",[n[0].toJSON(),n[1].toJSON(),_(n[2])]);if(n[0]instanceof m&&n[1]===null||n[1]instanceof m&&n[0]===null||n[0]===null&&n[1]===null)return!1;throw new o(t,s.InvalidParameter,e)})},a.functions.intersection=function(t,e){return a.standardFunctionAsync(t,e,async(l,u,n)=>(n=d(n),g(n,t,e),n[0]===null||n[1]===null?null:y(await f("intersection",[n[0].toJSON(),n[1].toJSON()]))))},a.functions.union=function(t,e){return a.standardFunctionAsync(t,e,async(l,u,n)=>{if((n=d(n)).length===0)throw new o(t,s.WrongNumberOfParameters,e);const r=[];if(n.length===1)if(v(n[0])){for(const i of d(n[0]))if(i!==null){if(!(i instanceof m))throw new o(t,s.InvalidParameter,e);r.push(i.toJSON())}}else{if(!J(n[0])){if(n[0]instanceof m)return q(O(n[0]),t.spatialReference);if(n[0]===null)return null;throw new o(t,s.InvalidParameter,e)}for(const i of d(n[0].toArray()))if(i!==null){if(!(i instanceof m))throw new o(t,s.InvalidParameter,e);r.push(i.toJSON())}}else for(const i of n)if(i!==null){if(!(i instanceof m))throw new o(t,s.InvalidParameter,e);r.push(i.toJSON())}return r.length===0?null:y(await f("union",[r]))})},a.functions.difference=function(t,e){return a.standardFunctionAsync(t,e,async(l,u,n)=>(n=d(n),g(n,t,e),n[0]===null?null:n[1]===null?O(n[0]):y(await f("difference",[n[0].toJSON(),n[1].toJSON()]))))},a.functions.symmetricdifference=function(t,e){return a.standardFunctionAsync(t,e,async(l,u,n)=>(n=d(n),g(n,t,e),n[0]===null&&n[1]===null?null:n[0]===null?O(n[1]):n[1]===null?O(n[0]):y(await f("symmetricDifference",[n[0].toJSON(),n[1].toJSON()]))))},a.functions.clip=function(t,e){return a.standardFunctionAsync(t,e,async(l,u,n)=>{if(n=d(n),h(n,2,2,t,e),!(n[1]instanceof R)&&n[1]!==null)throw new o(t,s.InvalidParameter,e);if(n[0]===null)return null;if(!(n[0]instanceof m))throw new o(t,s.InvalidParameter,e);return n[1]===null?null:y(await f("clip",[n[0].toJSON(),n[1].toJSON()]))})},a.functions.cut=function(t,e){return a.standardFunctionAsync(t,e,async(l,u,n)=>{if(n=d(n),h(n,2,2,t,e),!(n[1]instanceof U)&&n[1]!==null)throw new o(t,s.InvalidParameter,e);if(n[0]===null)return[];if(!(n[0]instanceof m))throw new o(t,s.InvalidParameter,e);return n[1]===null?[O(n[0])]:(await f("cut",[n[0].toJSON(),n[1].toJSON()])).map(r=>y(r))})},a.functions.area=function(t,e){return a.standardFunctionAsync(t,e,async(l,u,n)=>{if(h(n,1,2,t,e),n=d(n),L(n[0])){const i=await n[0].sumArea(p(n[1]),!1,t.abortSignal);if(t.abortSignal.aborted)throw new o(t,s.Cancelled,e);return i}let r=n[0];if((v(r)||J(r))&&(r=M(n[0],t.spatialReference)),r===null)return 0;if(!(r instanceof m))throw new o(t,s.InvalidParameter,e);return f("area",[r.toJSON(),p(n[1])])})},a.functions.areageodetic=function(t,e){return a.standardFunctionAsync(t,e,async(l,u,n)=>{if(h(n,1,2,t,e),n=d(n),L(n[0])){const i=await n[0].sumArea(p(n[1]),!0,t.abortSignal);if(t.abortSignal.aborted)throw new o(t,s.Cancelled,e);return i}let r=n[0];if((v(n[0])||J(n[0]))&&(r=M(n[0],t.spatialReference)),r===null)return 0;if(!(r instanceof m))throw new o(t,s.InvalidParameter,e);return f("geodeticArea",[r.toJSON(),p(n[1])])})},a.functions.length=function(t,e){return a.standardFunctionAsync(t,e,async(l,u,n)=>{if(h(n,1,2,t,e),n=d(n),L(n[0])){const i=await n[0].sumLength(p(n[1]),!1,t.abortSignal);if(t.abortSignal.aborted)throw new o(t,s.Cancelled,e);return i}let r=n[0];if((v(n[0])||J(n[0]))&&(r=Z(n[0],t.spatialReference)),r===null)return 0;if(!(r instanceof m))throw new o(t,s.InvalidParameter,e);return f("length",[r.toJSON(),p(n[1])])})},a.functions.length3d=function(t,e){return a.standardFunctionAsync(t,e,async(l,u,n)=>{if(h(n,1,2,t,e),(n=d(n))[0]===null)return 0;let r=n[0];if((v(n[0])||J(n[0]))&&(r=Z(n[0],t.spatialReference)),r===null)return 0;if(!(r instanceof m))throw new o(t,s.InvalidParameter,e);if(r.hasZ===!0){const{convertFromSpatialReferenceUnit:i,toLengthUnit:c}=await Y(()=>import("./unitConversion-f06e764a.js").then(N=>N.e),["assets/unitConversion-f06e764a.js","assets/index-ee1133ea.js","assets/index-149229fc.css"]),w=$(r);return i(r.spatialReference,c(n[1]),w)}return f("length",[r.toJSON(),p(n[1])])})},a.functions.lengthgeodetic=function(t,e){return a.standardFunctionAsync(t,e,async(l,u,n)=>{if(h(n,1,2,t,e),n=d(n),L(n[0])){const i=await n[0].sumLength(p(n[1]),!0,t.abortSignal);if(t.abortSignal.aborted)throw new o(t,s.Cancelled,e);return i}let r=n[0];if((v(n[0])||J(n[0]))&&(r=Z(n[0],t.spatialReference)),r===null)return 0;if(!(r instanceof m))throw new o(t,s.InvalidParameter,e);return f("geodeticLength",[r.toJSON(),p(n[1])])})},a.functions.distance=function(t,e){return a.standardFunctionAsync(t,e,async(l,u,n)=>{n=d(n),h(n,2,3,t,e);let r=n[0];if((v(n[0])||J(n[0]))&&(r=z(n[0],t.spatialReference)),!(r instanceof m))throw new o(t,s.InvalidParameter,e);let i=n[1];if((v(n[1])||J(n[1]))&&(i=z(n[1],t.spatialReference)),!(i instanceof m))throw new o(t,s.InvalidParameter,e);return f("distance",[r.toJSON(),i.toJSON(),p(n[2])])})},a.functions.distancegeodetic=function(t,e){return a.standardFunctionAsync(t,e,async(l,u,n)=>{n=d(n),h(n,2,3,t,e);const r=n[0];if(!(r instanceof b))throw new o(t,s.InvalidParameter,e);const i=n[1];if(!(i instanceof b))throw new o(t,s.InvalidParameter,e);const c=new U({paths:[],spatialReference:r.spatialReference});return c.addPath([r,i]),f("geodeticLength",[c.toJSON(),p(n[2])])})},a.functions.densify=function(t,e){return a.standardFunctionAsync(t,e,async(l,u,n)=>{if(n=d(n),h(n,2,3,t,e),n[0]===null)return null;if(!(n[0]instanceof m))throw new o(t,s.InvalidParameter,e);const r=P(n[1]);if(isNaN(r))throw new o(t,s.InvalidParameter,e);if(r<=0)throw new o(t,s.InvalidParameter,e);switch(n[0].type){case"polygon":case"polyline":case"extent":return y(await f("densify",[n[0].toJSON(),r,p(n[2])]));default:return n[0]}})},a.functions.densifygeodetic=function(t,e){return a.standardFunctionAsync(t,e,async(l,u,n)=>{if(n=d(n),h(n,2,3,t,e),n[0]===null)return null;if(!(n[0]instanceof m))throw new o(t,s.InvalidParameter,e);const r=P(n[1]);if(isNaN(r))throw new o(t,s.InvalidParameter,e);if(r<=0)throw new o(t,s.InvalidParameter,e);switch(n[0].type){case"polygon":case"polyline":case"extent":return y(await f("geodeticDensify",[n[0].toJSON(),r,p(n[2])]));default:return n[0]}})},a.functions.generalize=function(t,e){return a.standardFunctionAsync(t,e,async(l,u,n)=>{if(n=d(n),h(n,2,4,t,e),n[0]===null)return null;if(!(n[0]instanceof m))throw new o(t,s.InvalidParameter,e);const r=P(n[1]);if(isNaN(r))throw new o(t,s.InvalidParameter,e);const i=nn(D(n[2],!0));return y(await f("generalize",[n[0].toJSON(),r,p(n[3]),{removeDegenerateParts:i}]))})},a.functions.buffer=function(t,e){return a.standardFunctionAsync(t,e,async(l,u,n)=>{if(n=d(n),h(n,2,3,t,e),n[0]===null)return null;if(!(n[0]instanceof m))throw new o(t,s.InvalidParameter,e);const r=P(n[1]);if(isNaN(r))throw new o(t,s.InvalidParameter,e);return r===0?O(n[0]):y(await f("buffer",[n[0].toJSON(),r,p(n[2])]))})},a.functions.buffergeodetic=function(t,e){return a.standardFunctionAsync(t,e,async(l,u,n)=>{if(n=d(n),h(n,2,3,t,e),n[0]===null)return null;if(!(n[0]instanceof m))throw new o(t,s.InvalidParameter,e);const r=P(n[1]);if(isNaN(r))throw new o(t,s.InvalidParameter,e);return r===0?O(n[0]):y(await f("geodesicBuffer",[n[0].toJSON(),r,p(n[2])]))})},a.functions.offset=function(t,e){return a.standardFunctionAsync(t,e,async(l,u,n)=>{if(n=d(n),h(n,2,6,t,e),n[0]===null)return null;if(!(n[0]instanceof x||n[0]instanceof U))throw new o(t,s.InvalidParameter,e);const r=P(n[1]);if(isNaN(r))throw new o(t,s.InvalidParameter,e);const i=_(n[3]??"round").toLowerCase();let c;switch(i){case"round":case"bevel":case"miter":case"square":c=i;break;default:c="round"}const w=P(D(n[4],10));if(isNaN(w))throw new o(t,s.InvalidParameter,e);const N=P(D(n[5],0));if(isNaN(N))throw new o(t,s.InvalidParameter,e);return y(await f("offset",[n[0].toJSON(),r,p(n[2]),{joins:c,miterLimit:w,flattenError:N}]))})},a.functions.rotate=function(t,e){return a.standardFunctionAsync(t,e,async(l,u,n)=>{var w;if(n=d(n),h(n,2,3,t,e),n[0]===null)return null;if(!(n[0]instanceof m))throw new o(t,s.InvalidParameter,e);const r=n[0]instanceof R?x.fromExtent(n[0]):n[0],i=P(n[1]);if(isNaN(i))throw new o(t,s.InvalidParameter,e);const c=D(n[2],null);if(c===null){const N=r.type==="point"?r:(w=r.extent)==null?void 0:w.center;return y(await f("rotate",[r.toJSON(),i,N==null?void 0:N.x,N==null?void 0:N.y]))}if(c instanceof b)return y(await f("rotate",[r.toJSON(),i,c.x,c.y]));throw new o(t,s.InvalidParameter,e)})},a.functions.centroid=function(t,e){return a.standardFunctionAsync(t,e,async(l,u,n)=>{if(n=d(n),h(n,1,2,t,e),n[0]===null)return null;const r=_(n[1]??"geometric").toLowerCase();if(r!=="geometric"&&r!=="labelpoint")throw new o(t,s.InvalidParameter,e);let i=n[0];if((v(n[0])||J(n[0]))&&(i=r==="geometric"?z(n[0],t.spatialReference):M(n[0],t.spatialReference),i===null))return null;if(!(i instanceof m))throw new o(t,s.InvalidParameter,e);return y(r==="geometric"?await f("centroid",[i.toJSON()]):await f("labelPoint",[i.toJSON()]))})},a.functions.measuretocoordinate=function(t,e){return a.standardFunctionAsync(t,e,tn)},a.functions.pointtocoordinate=function(t,e){return a.standardFunctionAsync(t,e,en)},a.functions.distancetocoordinate=function(t,e){return a.standardFunctionAsync(t,e,rn)},a.functions.multiparttosinglepart=function(t,e){return a.standardFunctionAsync(t,e,async(l,u,n)=>{if(n=d(n),h(n,1,1,t,e),n[0]===null)return null;if(!(n[0]instanceof m))throw new o(t,s.InvalidParameter,e);if(n[0]instanceof b)return[q(O(n[0]),t.spatialReference)];if(n[0]instanceof R)return[q(O(n[0]),t.spatialReference)];const r=y(await f("simplify",[n[0].toJSON()]));if(r instanceof x){const i=[],c=[];for(let w=0;w<r.rings.length;w++)if(r.isClockwise(r.rings[w])){const N=y({rings:[r.rings[w]],hasZ:r.hasZ===!0,hasM:r.hasM===!0,spatialReference:r.spatialReference.toJSON()});i.push(N)}else c.push({ring:r.rings[w],pt:r.getPoint(w,0)});for(let w=0;w<c.length;w++)for(let N=0;N<i.length;N++)if(i[N].contains(c[w].pt)){i[N].addRing(c[w].ring);break}return i}if(r instanceof U){const i=[];for(let c=0;c<r.paths.length;c++){const w=y({paths:[r.paths[c]],hasZ:r.hasZ===!0,hasM:r.hasM===!0,spatialReference:r.spatialReference.toJSON()});i.push(w)}return i}if(n[0]instanceof T){const i=[],c=q(O(n[0]),t.spatialReference);for(let w=0;w<c.points.length;w++)i.push(c.getPoint(w));return i}return null})},a.functions.issimple=function(t,e){return a.standardFunctionAsync(t,e,(l,u,n)=>{if(n=d(n),h(n,1,1,t,e),n[0]===null)return!0;if(!(n[0]instanceof m))throw new o(t,s.InvalidParameter,e);return f("isSimple",[n[0].toJSON()])})},a.functions.simplify=function(t,e){return a.standardFunctionAsync(t,e,async(l,u,n)=>{if(n=d(n),h(n,1,1,t,e),n[0]===null)return null;if(!(n[0]instanceof m))throw new o(t,s.InvalidParameter,e);return y(await f("simplify",[n[0].toJSON()]))})},a.functions.convexhull=function(t,e){return a.standardFunctionAsync(t,e,async(l,u,n)=>{if(n=d(n),h(n,1,1,t,e),n[0]===null)return null;if(!(n[0]instanceof m))throw new o(t,s.InvalidParameter,e);return y(await f("convexHull",[n[0].toJSON()]))})},a.functions.getuser=function(t,e){return a.standardFunctionAsync(t,e,async(l,u,n)=>{var w,N;h(n,0,2,t,e);let r=D(n[1],""),i=r===!0;if(r=r===!0||r===!1?"":_(r),n.length===0||n[0]instanceof W){let I;I=(w=t.services)!=null&&w.portal?t.services.portal:k.getDefault(),n.length>0&&(I=K(n[0],I));const F=await Q(I,r,i);if(F){const A=JSON.parse(JSON.stringify(F));for(const S of["lastLogin","created","modified"])A[S]!==void 0&&A[S]!==null&&(A[S]=new Date(A[S]));return j.convertObjectToArcadeDictionary(A,C(t))}return null}let c=null;if(L(n[0])&&(c=n[0]),c){if(i=!1,r)return null;await c.load();const I=await c.getOwningSystemUrl();if(!I){if(!r){const S=await c.getIdentityUser();return S?j.convertObjectToArcadeDictionary({username:S},C(t)):null}return null}let F;F=(N=t.services)!=null&&N.portal?t.services.portal:k.getDefault(),F=K(new W(I),F);const A=await Q(F,r,i);if(A){const S=JSON.parse(JSON.stringify(A));for(const E of["lastLogin","created","modified"])S[E]!==void 0&&S[E]!==null&&(S[E]=new Date(S[E]));return j.convertObjectToArcadeDictionary(S,C(t))}return null}throw new o(t,s.InvalidParameter,e)})},a.functions.nearestcoordinate=function(t,e){return a.standardFunctionAsync(t,e,async(l,u,n)=>{if(n=d(n),h(n,2,2,t,e),!(n[0]instanceof m||n[0]===null))throw new o(t,s.InvalidParameter,e);if(!(n[1]instanceof b||n[1]===null))throw new o(t,s.InvalidParameter,e);if(n[0]===null||n[1]===null)return null;const r=n[0]instanceof R?x.fromExtent(n[0]):n[0],i=await f("getNearestCoordinate",[r.toJSON(),n[1].toJSON(),{calculateLeftRightSide:!0}]);return i===null?null:j.convertObjectToArcadeDictionary({coordinate:y(i.coordinate),distance:i.distance,sideOfLine:i.distance===0?"straddle":i.rightSide?"right":"left"},C(t),!1,!0)})},a.functions.nearestvertex=function(t,e){return a.standardFunctionAsync(t,e,async(l,u,n)=>{if(n=d(n),h(n,2,2,t,e),!(n[0]instanceof m||n[0]===null))throw new o(t,s.InvalidParameter,e);if(!(n[1]instanceof b||n[1]===null))throw new o(t,s.InvalidParameter,e);if(n[0]===null||n[1]===null)return null;const r=n[0]instanceof R?x.fromExtent(n[0]):n[0],i=await f("getNearestVertex",[r.toJSON(),n[1].toJSON()]);return i===null?null:j.convertObjectToArcadeDictionary({coordinate:y(i.coordinate),distance:i.distance,sideOfLine:i.distance===0?"straddle":i.rightSide?"right":"left"},C(t),!1,!0)})})}export{gn as registerFunctions};
