import{D as y,F as f,ca as R,J as u,K as c,gG as _,W as E,dj as V,I as v,aL as I,B as T,gp as l,_ as n,gH as w,b as h,ab as A}from"./index-ee1133ea.js";import{s as Q,a as N}from"./executeForIds-53f40c95.js";import{x as L}from"./query-9bf2487e.js";import{a as P}from"./executeQueryJSON-1a1762fd.js";import{n as q}from"./executeQueryPBF-8cc144fe.js";async function $(e,t,r){const i=y(e),s=await L(i,f.from(t),{...r}),o=s.data.extent;return!o||isNaN(o.xmin)||isNaN(o.ymin)||isNaN(o.xmax)||isNaN(o.ymax)?{count:s.data.count,extent:null}:{count:s.data.count,extent:R.fromJSON(o)}}let a=class extends V{constructor(e){super(e),this.dynamicDataSource=null,this.fieldsIndex=null,this.gdbVersion=null,this.infoFor3D=null,this.pbfSupported=!1,this.queryAttachmentsSupported=!1,this.sourceSpatialReference=null,this.url=null}get parsedUrl(){return v(this.url)}async execute(e,t){const r=await this.executeJSON(e,t);return this.featureSetFromJSON(e,r,t)}async executeJSON(e,t){var d;const r=this._normalizeQuery(e),i=((d=e.outStatistics)==null?void 0:d[0])!=null,s=I("featurelayer-pbf-statistics"),o=(!i||s)&&e.returnTrueCurves!==!0;let p;if(this.pbfSupported&&o)try{p=await q(this.url,r,t)}catch(m){if(m.name!=="query:parsing-pbf")throw m;this.pbfSupported=!1}return this.pbfSupported&&o||(p=await P(this.url,r,t)),this._normalizeFields(p.fields),p}async featureSetFromJSON(e,t,r){if(!this._queryIs3DObjectFormat(e)||this.infoFor3D==null||!t.features)return T.fromJSON(t);const{meshFeatureSetFromJSON:i}=await l(n(()=>import("./meshFeatureSet-47af1087.js"),["assets/meshFeatureSet-47af1087.js","assets/index-ee1133ea.js","assets/index-149229fc.css","assets/Mesh-9168f605.js","assets/axisAngleDegrees-518cf2b4.js","assets/quat-2e3c8037.js","assets/mat3f64-e19cdcb8.js","assets/quatf64-216ddd5a.js","assets/MeshComponent-0478ab9b.js","assets/meshProperties-01219fec.js","assets/MeshLocalVertexSpace-1625db68.js","assets/MeshTransform-70c753bd.js","assets/mat4f64-7b47076d.js","assets/MeshVertexAttributes-c8dc5b24.js","assets/meshVertexSpaceUtils-6f0c1303.js","assets/triangulationUtils-87c1435a.js","assets/earcut-5a6c70eb.js","assets/Indices-c4700608.js","assets/plane-867b9076.js","assets/deduplicate-9944b2d9.js","assets/projectPointToVector-5ad9f65f.js","assets/vertexSpaceConversion-04dc2d09.js","assets/spatialReferenceEllipsoidUtils-fef0e593.js","assets/computeTranslationToOriginAndRotation-d98e4d1f.js","assets/vec3-eed24f88.js","assets/BufferView-ecc75b84.js","assets/vec4-8f193cb6.js","assets/External-3e16a3cf.js","assets/meshFeatureAttributes-3b547717.js"]),r);return i(e,this.infoFor3D,t)}executeForCount(e,t){return Q(this.url,this._normalizeQuery(e),t)}executeForExtent(e,t){return $(this.url,this._normalizeQuery(e),t)}executeForIds(e,t){return N(this.url,this._normalizeQuery(e),t)}async executeRelationshipQuery(e,t){const[{default:r},{executeRelationshipQuery:i}]=await l(Promise.all([n(()=>import("./index-ee1133ea.js").then(s=>s.uL),["assets/index-ee1133ea.js","assets/index-149229fc.css"]),n(()=>import("./executeRelationshipQuery-b71cf58e.js"),["assets/executeRelationshipQuery-b71cf58e.js","assets/index-ee1133ea.js","assets/index-149229fc.css","assets/query-9bf2487e.js","assets/pbfQueryUtils-efcbbb44.js","assets/pbf-1e25fe11.js","assets/memoryEstimations-c448ab60.js","assets/OptimizedGeometry-3060442a.js","assets/OptimizedFeature-85f1966b.js","assets/OptimizedFeatureSet-1d1ac4b9.js"])]),t);return e=r.from(e),(this.gdbVersion||this.dynamicDataSource)&&((e=e.clone()).gdbVersion=e.gdbVersion||this.gdbVersion,e.dynamicDataSource=e.dynamicDataSource||this.dynamicDataSource),i(this.url,e,t)}async executeRelationshipQueryForCount(e,t){const[{default:r},{executeRelationshipQueryForCount:i}]=await l(Promise.all([n(()=>import("./index-ee1133ea.js").then(s=>s.uL),["assets/index-ee1133ea.js","assets/index-149229fc.css"]),n(()=>import("./executeRelationshipQuery-b71cf58e.js"),["assets/executeRelationshipQuery-b71cf58e.js","assets/index-ee1133ea.js","assets/index-149229fc.css","assets/query-9bf2487e.js","assets/pbfQueryUtils-efcbbb44.js","assets/pbf-1e25fe11.js","assets/memoryEstimations-c448ab60.js","assets/OptimizedGeometry-3060442a.js","assets/OptimizedFeature-85f1966b.js","assets/OptimizedFeatureSet-1d1ac4b9.js"])]),t);return e=r.from(e),(this.gdbVersion||this.dynamicDataSource)&&((e=e.clone()).gdbVersion=e.gdbVersion||this.gdbVersion,e.dynamicDataSource=e.dynamicDataSource||this.dynamicDataSource),i(this.url,e,t)}async executeAttachmentQuery(e,t){const{executeAttachmentQuery:r,fetchAttachments:i,processAttachmentQueryResult:s}=await l(n(()=>import("./queryAttachments-76bbfee7.js"),["assets/queryAttachments-76bbfee7.js","assets/index-ee1133ea.js","assets/index-149229fc.css","assets/query-9bf2487e.js","assets/pbfQueryUtils-efcbbb44.js","assets/pbf-1e25fe11.js","assets/memoryEstimations-c448ab60.js","assets/OptimizedGeometry-3060442a.js","assets/OptimizedFeature-85f1966b.js","assets/OptimizedFeatureSet-1d1ac4b9.js","assets/AttachmentInfo-0defa87f.js"]),t),o=y(this.url);return s(o,await(this.queryAttachmentsSupported?r(o,e,t):i(o,e,t)))}async executeAttributeBinsQuery(e,t){const{executeAttributeBinsQuery:r}=await l(n(()=>import("./executeAttributeBinsQuery-2ef9a42d.js"),["assets/executeAttributeBinsQuery-2ef9a42d.js","assets/index-ee1133ea.js","assets/index-149229fc.css","assets/query-9bf2487e.js","assets/pbfQueryUtils-efcbbb44.js","assets/pbf-1e25fe11.js","assets/memoryEstimations-c448ab60.js","assets/OptimizedGeometry-3060442a.js","assets/OptimizedFeature-85f1966b.js","assets/OptimizedFeatureSet-1d1ac4b9.js","assets/AttributeBinsFeatureSet-0ea0b6bc.js","assets/AttributeBinsQuery-9d4993aa.js","assets/queryUtils-7e537050.js","assets/json-48e3ea08.js","assets/FixedIntervalBinParameters-264449c4.js"]),t);return r(this.parsedUrl,e,t)}async executeTopFeaturesQuery(e,t){const{executeTopFeaturesQuery:r}=await l(n(()=>import("./executeTopFeaturesQuery-2b50bc7d.js"),["assets/executeTopFeaturesQuery-2b50bc7d.js","assets/index-ee1133ea.js","assets/index-149229fc.css","assets/queryTopFeatures-6d74b1b5.js","assets/query-9bf2487e.js","assets/pbfQueryUtils-efcbbb44.js","assets/pbf-1e25fe11.js","assets/memoryEstimations-c448ab60.js","assets/OptimizedGeometry-3060442a.js","assets/OptimizedFeature-85f1966b.js","assets/OptimizedFeatureSet-1d1ac4b9.js","assets/TopFeaturesQuery-d613198f.js"]),t);return r(this.parsedUrl,e,this.sourceSpatialReference,t)}async executeForTopIds(e,t){const{executeForTopIds:r}=await l(n(()=>import("./executeForTopIds-3b7df148.js"),["assets/executeForTopIds-3b7df148.js","assets/index-ee1133ea.js","assets/index-149229fc.css","assets/queryTopFeatures-6d74b1b5.js","assets/query-9bf2487e.js","assets/pbfQueryUtils-efcbbb44.js","assets/pbf-1e25fe11.js","assets/memoryEstimations-c448ab60.js","assets/OptimizedGeometry-3060442a.js","assets/OptimizedFeature-85f1966b.js","assets/OptimizedFeatureSet-1d1ac4b9.js","assets/TopFeaturesQuery-d613198f.js"]),t);return r(this.parsedUrl,e,t)}async executeForTopExtents(e,t){const{executeForTopExtents:r}=await l(n(()=>import("./executeForTopExtents-f4edb01e.js"),["assets/executeForTopExtents-f4edb01e.js","assets/index-ee1133ea.js","assets/index-149229fc.css","assets/queryTopFeatures-6d74b1b5.js","assets/query-9bf2487e.js","assets/pbfQueryUtils-efcbbb44.js","assets/pbf-1e25fe11.js","assets/memoryEstimations-c448ab60.js","assets/OptimizedGeometry-3060442a.js","assets/OptimizedFeature-85f1966b.js","assets/OptimizedFeatureSet-1d1ac4b9.js","assets/TopFeaturesQuery-d613198f.js"]),t);return r(this.parsedUrl,e,t)}async executeForTopCount(e,t){const{executeForTopCount:r}=await l(n(()=>import("./executeForTopCount-abda7fc1.js"),["assets/executeForTopCount-abda7fc1.js","assets/index-ee1133ea.js","assets/index-149229fc.css","assets/queryTopFeatures-6d74b1b5.js","assets/query-9bf2487e.js","assets/pbfQueryUtils-efcbbb44.js","assets/pbf-1e25fe11.js","assets/memoryEstimations-c448ab60.js","assets/OptimizedGeometry-3060442a.js","assets/OptimizedFeature-85f1966b.js","assets/OptimizedFeatureSet-1d1ac4b9.js","assets/TopFeaturesQuery-d613198f.js"]),t);return r(this.parsedUrl,e,t)}_normalizeQuery(e){let t=f.from(e);t.sourceSpatialReference=t.sourceSpatialReference||this.sourceSpatialReference,(this.gdbVersion||this.dynamicDataSource)&&(t=t===e?t.clone():t,t.gdbVersion=e.gdbVersion||this.gdbVersion,t.dynamicDataSource=e.dynamicDataSource?_.from(e.dynamicDataSource):this.dynamicDataSource);const{infoFor3D:r}=this;if(r!=null&&this._queryIs3DObjectFormat(e)){if(t=t===e?t.clone():t,t.formatOf3DObjects=w(r),!t.formatOf3DObjects)throw new h("query:unsupported-3d-query-formats","Could not find any supported 3D object query format. Only supported formats are 3D_glb and 3D_gltf");if(t.outSpatialReference&&!A(t.outSpatialReference,this.sourceSpatialReference))throw new h("query:unsupported-out-spatial-reference","3D object feature services do not support projection of geometries");if(t.outFields==null||!t.outFields.includes("*")){t=t===e?t.clone():t,t.outFields==null&&(t.outFields=[]);const{originX:i,originY:s,originZ:o,translationX:p,translationY:d,translationZ:m,scaleX:S,scaleY:D,scaleZ:x,rotationX:F,rotationY:b,rotationZ:g,rotationDeg:O}=r.transformFieldRoles;t.outFields.push(i,s,o,p,d,m,S,D,x,F,b,g,O)}}return t}_normalizeFields(e){if(this.fieldsIndex!=null&&e!=null)for(const t of e){const r=this.fieldsIndex.get(t.name);r&&Object.assign(t,r.toJSON())}}_queryIs3DObjectFormat(e){return this.infoFor3D!=null&&e.returnGeometry===!0&&e.multipatchOption!=="xyFootprint"&&!e.outStatistics}};u([c({type:_})],a.prototype,"dynamicDataSource",void 0),u([c()],a.prototype,"fieldsIndex",void 0),u([c()],a.prototype,"gdbVersion",void 0),u([c()],a.prototype,"infoFor3D",void 0),u([c({readOnly:!0})],a.prototype,"parsedUrl",null),u([c()],a.prototype,"pbfSupported",void 0),u([c()],a.prototype,"queryAttachmentsSupported",void 0),u([c()],a.prototype,"sourceSpatialReference",void 0),u([c({type:String})],a.prototype,"url",void 0),a=u([E("esri.layers.graphics.sources.support.QueryTask")],a);const X=a;export{X as F};
