import{G as N}from"./index-ee1133ea.js";import{t as M}from"./SimpleGeometryCursor-e3941f41.js";import{a as R,b as $,m as Q}from"./Transformation2D-6dd5ab6c.js";import{N as w,aP as Z,w as q,c as f,T as x,aQ as j,aR as T,aS as b,aT as k,aU as B,aC as U,aV as F}from"./ProjectionTransformation-5bc4f99e.js";import{getSpatialReference as H,fromSpatialReference as J,fromPolyline as K,fromGeometry as L,toGeometry as W}from"./apiConverter-0d48c0e6.js";var O=F;function g(l,e){return{m_geometry:l,m_side:e}}function X(l,e,o,t,m,r){if(e.isEmpty()){const a=g(e,0);return void m.push(a)}if(o.isEmpty()){const a=g(e,0);return void m.push(a)}const s=[],n=new x;{const a=n.createGeometryUserIndex(),C=n.addGeometry(e),I=n.addGeometry(o),d=new j(r);let p=0,i=null;if(n.hasCurves()){i=new O;const h=n.getEnvelope2D(r);p=T(t.total());const _=b(t.total(),h);k(n,_,t.total(),12e3,i,null,r)}n.dbgVerifyCurves(),d.setEditShapeCrackAndCluster(n,t),d.cut(l,a,C,I,s);for(const h of s){i!==null&&i.stitchCurves(n,h,p,!1);const _=g(n.getGeometry(h),B(n.getGeometryUserIndex(h,a)));m.push(_)}i!==null&&i.clearStitcher(n)}}function Y(l,e,o,t,m,r){if(e.isEmpty()){const a=g(e,0);return void m.push(a)}if(o.isEmpty()){const a=g(e,0);return void m.push(a)}const s=[],n=new x;{const a=n.createGeometryUserIndex(),C=n.addGeometry(e),I=n.addGeometry(o),d=new j(r);let p=0,i=null;if(n.hasCurves()){i=new O;const u=n.getEnvelope2D(r);p=T(t.total());const y=b(t.total(),u);k(n,y,t.total(),12e3,i,null,r)}n.dbgVerifyCurves(),d.setEditShapeCrackAndCluster(n,t),d.cut(!1,a,C,I,s),i!==null&&i.stitchCurves(n,U,p,!0);let h=n.getGeometry(C);const _=new f,E=new f,G=[];for(let u=0;u<s.length;u++){let y=null;{const c=new x,P=c.addGeometry(h),S=c.addGeometry(n.getGeometry(s[u]));if(c.hasCurves()){const D=c.getEnvelope2D(r);p=T(t.total());const z=b(t.total(),D);k(c,z,t.total(),12e3,i,null,r)}d.setEditShapeCrackAndCluster(c,t);const A=d.intersection(P,S);if(i!==null&&i.stitchCurves(c,U,p,!0),y=c.getGeometry(A),y.isEmpty())continue;const v=n.getGeometryUserIndex(s[u],a);v===2?_.add(y,!1):v===1?E.add(y,!1):G.push(y)}{const c=new x,P=c.addGeometry(h),S=c.addGeometry(n.getGeometry(s[u]));if(c.hasCurves()){const v=c.getEnvelope2D(r);p=T(t.total());const D=b(t.total(),v);k(c,D,t.total(),12e3,i,null,r)}d.setEditShapeCrackAndCluster(c,t);const A=d.difference(P,S);i!==null&&i.stitchCurves(c,U,p,!0),h=c.getGeometry(A)}}if(!h.isEmpty()&&s.length>0&&G.push(h),_.isEmpty()&&E.isEmpty())return;if(!_.isEmpty()){const u=g(_,1);m.push(u)}if(!E.isEmpty()){const u=g(E,2);m.push(u)}for(let u=0,y=G.length;u<y;++u){const c=g(G[u],3);m.push(c)}}}class tt{getOperatorType(){return 10005}accelerateGeometry(e,o,t){return!1}canAccelerateGeometry(e){return!1}supportsCurves(){return!0}execute(e,o,t,m,r){return new et(e,o,t,m,r)}}class et extends M{constructor(e,o,t,m,r){super(),this.m_cutIndex=-1,this.m_cuts=[],this.m_progressTracker=r,this.m_cuttee=o.clone(),this.m_cutter=new w({copy:t}),this.m_bConsiderTouch=e;const s=Z(o,t);this.m_tolerance=q(m,s,!0)}next(){return this.m_cutIndex===-1&&this.generateCuts(),++this.m_cutIndex<this.m_cuts.length?this.m_cuts[this.m_cutIndex]:null}getGeometryID(){return this.m_cutIndex}tock(){return!0}getRank(){return 1}generateCuts(){switch(this.m_cuttee.getGeometryType()){case R.enumPolyline:this.generatePolylineCuts();break;case R.enumPolygon:this.generatePolygonCuts()}}generatePolylineCuts(){const e=new w,o=new w,t=new w;this.m_cuts.length=0,this.m_cuts.push(e),this.m_cuts.push(o);const m=[];X(this.m_bConsiderTouch,this.m_cuttee,this.m_cutter,this.m_tolerance,m,this.m_progressTracker);for(let r=0;r<m.length;r++){const s=m[r];s.m_side===1?e.add(s.m_geometry,!1):s.m_side===2||s.m_side===4?o.add(s.m_geometry,!1):s.m_side===3?this.m_cuts.push(s.m_geometry):s.m_side===0?t.add(s.m_geometry,!1):$("")}t.isEmpty()||e.isEmpty()&&o.isEmpty()&&!(this.m_cuts.length>=3)||this.m_cuts.push(t),e.isEmpty()&&o.isEmpty()&&this.m_cuts.length<3&&(this.m_cuts.length=0)}generatePolygonCuts(){const e=new f,o=new f,t=new f;this.m_cuts.length=0,this.m_cuts.push(e),this.m_cuts.push(o);const m=[];Y(this.m_bConsiderTouch,this.m_cuttee,this.m_cutter,this.m_tolerance,m,this.m_progressTracker);for(let r=0;r<m.length;r++){const s=m[r];s.m_side===1?e.add(s.m_geometry,!1):s.m_side===2?o.add(s.m_geometry,!1):s.m_side===3?this.m_cuts.push(s.m_geometry):s.m_side===0?t.add(s.m_geometry,!1):$("")}Q(t.isEmpty()||m.length===1),e.isEmpty()&&o.isEmpty()&&this.m_cuts.length<3&&(this.m_cuts.length=0)}}const V=new tt;function st(l,e,o){const t=V.execute(!0,l,e,o,null);return Array.from(t)}function nt(){return V.supportsCurves()}function ot(l,e){const o=H(l);return st(L(l),K(e),J(o)).map(t=>W(t,o)).filter(N)}const rt=nt(),lt=Object.freeze(Object.defineProperty({__proto__:null,execute:ot,supportsCurves:rt},Symbol.toStringTag,{value:"Module"}));export{rt as c,lt as i,ot as m};
