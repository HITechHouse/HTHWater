import{D as y,F as f,ca as R,J as u,K as c,gG as _,W as E,dj as V,I as v,aL as I,B as T,gp as l,_ as n,gH as w,b as h,ab as A}from"./index-f5157718.js";import{s as Q,a as N}from"./executeForIds-e25c490a.js";import{x as L}from"./query-bbf38cc9.js";import{a as P}from"./executeQueryJSON-2818c840.js";import{n as q}from"./executeQueryPBF-d218a410.js";async function $(e,t,r){const i=y(e),s=await L(i,f.from(t),{...r}),o=s.data.extent;return!o||isNaN(o.xmin)||isNaN(o.ymin)||isNaN(o.xmax)||isNaN(o.ymax)?{count:s.data.count,extent:null}:{count:s.data.count,extent:R.fromJSON(o)}}let a=class extends V{constructor(e){super(e),this.dynamicDataSource=null,this.fieldsIndex=null,this.gdbVersion=null,this.infoFor3D=null,this.pbfSupported=!1,this.queryAttachmentsSupported=!1,this.sourceSpatialReference=null,this.url=null}get parsedUrl(){return v(this.url)}async execute(e,t){const r=await this.executeJSON(e,t);return this.featureSetFromJSON(e,r,t)}async executeJSON(e,t){var d;const r=this._normalizeQuery(e),i=((d=e.outStatistics)==null?void 0:d[0])!=null,s=I("featurelayer-pbf-statistics"),o=(!i||s)&&e.returnTrueCurves!==!0;let p;if(this.pbfSupported&&o)try{p=await q(this.url,r,t)}catch(m){if(m.name!=="query:parsing-pbf")throw m;this.pbfSupported=!1}return this.pbfSupported&&o||(p=await P(this.url,r,t)),this._normalizeFields(p.fields),p}async featureSetFromJSON(e,t,r){if(!this._queryIs3DObjectFormat(e)||this.infoFor3D==null||!t.features)return T.fromJSON(t);const{meshFeatureSetFromJSON:i}=await l(n(()=>import("./meshFeatureSet-3d9cfa18.js"),["assets/meshFeatureSet-3d9cfa18.js","assets/index-f5157718.js","assets/index-149229fc.css","assets/Mesh-c8c90101.js","assets/axisAngleDegrees-bcdcaa47.js","assets/quat-a74ccdda.js","assets/mat3f64-e19cdcb8.js","assets/quatf64-216ddd5a.js","assets/MeshComponent-4ff66e1d.js","assets/meshProperties-01219fec.js","assets/MeshLocalVertexSpace-205953f5.js","assets/MeshTransform-1d78c1ec.js","assets/mat4f64-7b47076d.js","assets/MeshVertexAttributes-ec7c877d.js","assets/meshVertexSpaceUtils-17de56f2.js","assets/triangulationUtils-04292d74.js","assets/earcut-5a6c70eb.js","assets/Indices-c3d21335.js","assets/plane-4ee7a2fd.js","assets/deduplicate-20054b53.js","assets/projectPointToVector-417832fa.js","assets/vertexSpaceConversion-a98124bf.js","assets/spatialReferenceEllipsoidUtils-53921753.js","assets/computeTranslationToOriginAndRotation-44aba095.js","assets/vec3-fb0321b6.js","assets/BufferView-5d617a3a.js","assets/vec4-35b317ed.js","assets/External-526b25c0.js","assets/meshFeatureAttributes-78864287.js"]),r);return i(e,this.infoFor3D,t)}executeForCount(e,t){return Q(this.url,this._normalizeQuery(e),t)}executeForExtent(e,t){return $(this.url,this._normalizeQuery(e),t)}executeForIds(e,t){return N(this.url,this._normalizeQuery(e),t)}async executeRelationshipQuery(e,t){const[{default:r},{executeRelationshipQuery:i}]=await l(Promise.all([n(()=>import("./index-f5157718.js").then(s=>s.uL),["assets/index-f5157718.js","assets/index-149229fc.css"]),n(()=>import("./executeRelationshipQuery-084beab6.js"),["assets/executeRelationshipQuery-084beab6.js","assets/index-f5157718.js","assets/index-149229fc.css","assets/query-bbf38cc9.js","assets/pbfQueryUtils-fd62a34b.js","assets/pbf-8ef4f2aa.js","assets/memoryEstimations-e8cfae6e.js","assets/OptimizedGeometry-4a66a431.js","assets/OptimizedFeature-6e8489c3.js","assets/OptimizedFeatureSet-1d1ac4b9.js"])]),t);return e=r.from(e),(this.gdbVersion||this.dynamicDataSource)&&((e=e.clone()).gdbVersion=e.gdbVersion||this.gdbVersion,e.dynamicDataSource=e.dynamicDataSource||this.dynamicDataSource),i(this.url,e,t)}async executeRelationshipQueryForCount(e,t){const[{default:r},{executeRelationshipQueryForCount:i}]=await l(Promise.all([n(()=>import("./index-f5157718.js").then(s=>s.uL),["assets/index-f5157718.js","assets/index-149229fc.css"]),n(()=>import("./executeRelationshipQuery-084beab6.js"),["assets/executeRelationshipQuery-084beab6.js","assets/index-f5157718.js","assets/index-149229fc.css","assets/query-bbf38cc9.js","assets/pbfQueryUtils-fd62a34b.js","assets/pbf-8ef4f2aa.js","assets/memoryEstimations-e8cfae6e.js","assets/OptimizedGeometry-4a66a431.js","assets/OptimizedFeature-6e8489c3.js","assets/OptimizedFeatureSet-1d1ac4b9.js"])]),t);return e=r.from(e),(this.gdbVersion||this.dynamicDataSource)&&((e=e.clone()).gdbVersion=e.gdbVersion||this.gdbVersion,e.dynamicDataSource=e.dynamicDataSource||this.dynamicDataSource),i(this.url,e,t)}async executeAttachmentQuery(e,t){const{executeAttachmentQuery:r,fetchAttachments:i,processAttachmentQueryResult:s}=await l(n(()=>import("./queryAttachments-855f3adf.js"),["assets/queryAttachments-855f3adf.js","assets/index-f5157718.js","assets/index-149229fc.css","assets/query-bbf38cc9.js","assets/pbfQueryUtils-fd62a34b.js","assets/pbf-8ef4f2aa.js","assets/memoryEstimations-e8cfae6e.js","assets/OptimizedGeometry-4a66a431.js","assets/OptimizedFeature-6e8489c3.js","assets/OptimizedFeatureSet-1d1ac4b9.js","assets/AttachmentInfo-a267afec.js"]),t),o=y(this.url);return s(o,await(this.queryAttachmentsSupported?r(o,e,t):i(o,e,t)))}async executeAttributeBinsQuery(e,t){const{executeAttributeBinsQuery:r}=await l(n(()=>import("./executeAttributeBinsQuery-6df91c2c.js"),["assets/executeAttributeBinsQuery-6df91c2c.js","assets/index-f5157718.js","assets/index-149229fc.css","assets/query-bbf38cc9.js","assets/pbfQueryUtils-fd62a34b.js","assets/pbf-8ef4f2aa.js","assets/memoryEstimations-e8cfae6e.js","assets/OptimizedGeometry-4a66a431.js","assets/OptimizedFeature-6e8489c3.js","assets/OptimizedFeatureSet-1d1ac4b9.js","assets/AttributeBinsFeatureSet-8e96a3d9.js","assets/AttributeBinsQuery-766a2411.js","assets/queryUtils-d1b9b043.js","assets/json-48e3ea08.js","assets/FixedIntervalBinParameters-16f91595.js"]),t);return r(this.parsedUrl,e,t)}async executeTopFeaturesQuery(e,t){const{executeTopFeaturesQuery:r}=await l(n(()=>import("./executeTopFeaturesQuery-f7ab037e.js"),["assets/executeTopFeaturesQuery-f7ab037e.js","assets/index-f5157718.js","assets/index-149229fc.css","assets/queryTopFeatures-14eb9d85.js","assets/query-bbf38cc9.js","assets/pbfQueryUtils-fd62a34b.js","assets/pbf-8ef4f2aa.js","assets/memoryEstimations-e8cfae6e.js","assets/OptimizedGeometry-4a66a431.js","assets/OptimizedFeature-6e8489c3.js","assets/OptimizedFeatureSet-1d1ac4b9.js","assets/TopFeaturesQuery-59433dc2.js"]),t);return r(this.parsedUrl,e,this.sourceSpatialReference,t)}async executeForTopIds(e,t){const{executeForTopIds:r}=await l(n(()=>import("./executeForTopIds-9bc247eb.js"),["assets/executeForTopIds-9bc247eb.js","assets/index-f5157718.js","assets/index-149229fc.css","assets/queryTopFeatures-14eb9d85.js","assets/query-bbf38cc9.js","assets/pbfQueryUtils-fd62a34b.js","assets/pbf-8ef4f2aa.js","assets/memoryEstimations-e8cfae6e.js","assets/OptimizedGeometry-4a66a431.js","assets/OptimizedFeature-6e8489c3.js","assets/OptimizedFeatureSet-1d1ac4b9.js","assets/TopFeaturesQuery-59433dc2.js"]),t);return r(this.parsedUrl,e,t)}async executeForTopExtents(e,t){const{executeForTopExtents:r}=await l(n(()=>import("./executeForTopExtents-42b6b07c.js"),["assets/executeForTopExtents-42b6b07c.js","assets/index-f5157718.js","assets/index-149229fc.css","assets/queryTopFeatures-14eb9d85.js","assets/query-bbf38cc9.js","assets/pbfQueryUtils-fd62a34b.js","assets/pbf-8ef4f2aa.js","assets/memoryEstimations-e8cfae6e.js","assets/OptimizedGeometry-4a66a431.js","assets/OptimizedFeature-6e8489c3.js","assets/OptimizedFeatureSet-1d1ac4b9.js","assets/TopFeaturesQuery-59433dc2.js"]),t);return r(this.parsedUrl,e,t)}async executeForTopCount(e,t){const{executeForTopCount:r}=await l(n(()=>import("./executeForTopCount-8b52488b.js"),["assets/executeForTopCount-8b52488b.js","assets/index-f5157718.js","assets/index-149229fc.css","assets/queryTopFeatures-14eb9d85.js","assets/query-bbf38cc9.js","assets/pbfQueryUtils-fd62a34b.js","assets/pbf-8ef4f2aa.js","assets/memoryEstimations-e8cfae6e.js","assets/OptimizedGeometry-4a66a431.js","assets/OptimizedFeature-6e8489c3.js","assets/OptimizedFeatureSet-1d1ac4b9.js","assets/TopFeaturesQuery-59433dc2.js"]),t);return r(this.parsedUrl,e,t)}_normalizeQuery(e){let t=f.from(e);t.sourceSpatialReference=t.sourceSpatialReference||this.sourceSpatialReference,(this.gdbVersion||this.dynamicDataSource)&&(t=t===e?t.clone():t,t.gdbVersion=e.gdbVersion||this.gdbVersion,t.dynamicDataSource=e.dynamicDataSource?_.from(e.dynamicDataSource):this.dynamicDataSource);const{infoFor3D:r}=this;if(r!=null&&this._queryIs3DObjectFormat(e)){if(t=t===e?t.clone():t,t.formatOf3DObjects=w(r),!t.formatOf3DObjects)throw new h("query:unsupported-3d-query-formats","Could not find any supported 3D object query format. Only supported formats are 3D_glb and 3D_gltf");if(t.outSpatialReference&&!A(t.outSpatialReference,this.sourceSpatialReference))throw new h("query:unsupported-out-spatial-reference","3D object feature services do not support projection of geometries");if(t.outFields==null||!t.outFields.includes("*")){t=t===e?t.clone():t,t.outFields==null&&(t.outFields=[]);const{originX:i,originY:s,originZ:o,translationX:p,translationY:d,translationZ:m,scaleX:S,scaleY:D,scaleZ:x,rotationX:F,rotationY:b,rotationZ:g,rotationDeg:O}=r.transformFieldRoles;t.outFields.push(i,s,o,p,d,m,S,D,x,F,b,g,O)}}return t}_normalizeFields(e){if(this.fieldsIndex!=null&&e!=null)for(const t of e){const r=this.fieldsIndex.get(t.name);r&&Object.assign(t,r.toJSON())}}_queryIs3DObjectFormat(e){return this.infoFor3D!=null&&e.returnGeometry===!0&&e.multipatchOption!=="xyFootprint"&&!e.outStatistics}};u([c({type:_})],a.prototype,"dynamicDataSource",void 0),u([c()],a.prototype,"fieldsIndex",void 0),u([c()],a.prototype,"gdbVersion",void 0),u([c()],a.prototype,"infoFor3D",void 0),u([c({readOnly:!0})],a.prototype,"parsedUrl",null),u([c()],a.prototype,"pbfSupported",void 0),u([c()],a.prototype,"queryAttachmentsSupported",void 0),u([c()],a.prototype,"sourceSpatialReference",void 0),u([c({type:String})],a.prototype,"url",void 0),a=u([E("esri.layers.graphics.sources.support.QueryTask")],a);const X=a;export{X as F};
